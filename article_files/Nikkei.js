var cX=window.cX=window.cX||{};cX.callQueue=cX.callQueue||[];cX.CCE=cX.CCE||{};cX.CCE.callQueue=cX.CCE.callQueue||[];var cx_args={prefix:"nik",pid:"b690ee49d065bfe42d0baaf3ee6d543d90608515",domainScriptPath:"Nikkei",siteIds:{"www.nikkei.com":"1146436379736327926","id.nikkei.com":"1146436379736327926","pr.nikkei.com":"1146436379736327926","r.nikkei.com":"1146436379736327926","regist.nikkei.com":"1146436379736327926","default":"1146436379736327926"},productIds:{free:"8n3m1slrwh7g",paid:"8n3m1slrwh7f"},funnelSteps:["convertProduct","terminateProduct"],cpl:[],sal:[],cpMaxLen:256,cpKeyLen:20,firstCall:true,pvopts:{}};var cxj_dmp_params={origin:cx_args.prefix+"-web",persistedQueryId:cx_args.pid};cX.callQueue.unshift(["invoke",function(){cxSetCP()}]);cX.callQueue.unshift(["setEventAttributes",cxj_dmp_params]);cX.callQueue.unshift(["invoke",function(){cxSetSiteId()}]);function cxSetSiteId(){var siteId=cx_args.siteIds[location.hostname]||cx_args.siteIds.default;if(siteId){cX.setSiteId(siteId)}}function cxCCEConversion(product,step,options){var funnelStep=step||"convertProduct";var productId=cx_args.productIds[product];if(productId&&cx_args.funnelSteps.indexOf(funnelStep)!==-1){cX.CCE.callQueue.push(["sendConversionEvent",{productId:productId,funnelStep:funnelStep},options||{}]);cX.sendEvent(funnelStep,{productId:productId},cxj_dmp_params)}}function cxSendPV(){cX.CCE.sendPageViewEvent(cx_args.prefix,cx_args.pid,cx_args.pvopts);cx_args.firstCall=false}function cxSetCP(args){var cp={},sa={};var now=new Date;cx_args.pvopts.referrer=null;Object.assign(cx_args.pvopts,args||{});if(!cx_args.firstCall){cX.initializePage()}try{var refhost=cX.library._findRealReferrer().split("/")[2];if(args&&args.referrer){refhost=args.referrer.split("/")[2]}if(refhost&&location.hostname!==refhost){cp["referrer_host"]=sa["referrer_host_S"]=refhost.slice(0,cx_args.cpMaxLen)}}catch(e){}var u=["utm_source","utm_medium","utm_term","utm_content","utm_campaign"];if(typeof cx_args.sal!=="undefined"&&Object.prototype.toString.call(cx_args.sal)==="[object Array]"){Array.prototype.push.apply(u,cx_args.sal)}if(location.search)location.search.substring(1).split("&").forEach(function(k){try{var v=k.split("=");if(v[0].slice(0,3)==="cx_"&&v[1]){sa[v[0].replace(/^cx_/,"")+"_S"]=decodeURIComponent(v[1]).slice(0,cx_args.cpMaxLen)}else if(u.indexOf(v[0].toLowerCase())!==-1&&v[1]){cp[v[0].toLowerCase().slice(0,cx_args.cpKeyLen)]=sa[v[0].toLowerCase()+"_S"]=decodeURIComponent(v[1]).slice(0,cx_args.cpMaxLen)}else if(typeof cx_args.cpl!=="undefined"&&Object.prototype.toString.call(cx_args.cpl)==="[object Array]"&&(cx_args.cpl.indexOf(v[0].toLowerCase())!==-1&&v[1])){cp[v[0].toLowerCase().slice(0,cx_args.cpKeyLen)]=decodeURIComponent(v[1]).slice(0,cx_args.cpMaxLen)}}catch(e){}});if(!cX.getUserId(false)){cp["newuser"]=sa["newuser_S"]="true"}else{try{var t=now.getTime()-parseInt(cX.library.m_atfr.match(/altm=(\d+)/)[1]);if(t>=1e3*60*30){cX.stopAllSessionAnnotations();var da=Math.floor(t/(1e3*60*60*24));if(da<1){cp["elapsed"]=sa["elapsed_S"]="1日以内"}else if(da<7){cp["elapsed"]=sa["elapsed_S"]=String(da)+"日ぶり"}else if(da<31){cp["elapsed"]=sa["elapsed_S"]=String(Math.floor(da/7))+"週間ぶり"}else if(da<365){cp["elapsed"]=sa["elapsed_S"]=String(Math.floor(da/31))+"ヶ月ぶり"}else{cp["elapsed"]=sa["elapsed_S"]="1年以上"}}}catch(e){}}cp["hour"]=now.getHours();cp["wday"]=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][now.getDay()];if(document.referrer.match(/cdn\.cxpublic\.com\/generic_v[0-9]+\.html/)){sa["cx_source_S"]="cxrecs"}if(Object.keys(cp).length>0){cX.setCustomParameters(cp)}if(Object.keys(sa).length>0){cX.startSessionAnnotation(sa)}}(function(d,s,e,t){var element=d.createElement(s);element.type="text/java"+s;element.async="async";element.src="http"+("https:"===location.protocol?"s://s":"://")+"cdn.cxense.com/cx.cce.js";var tag=d.getElementsByTagName(s)[0];tag.parentNode.insertBefore(element,tag)})(document,"script");(function(){if(_isRobot()){return}var cxIoScrollDepth=function(){var _instance;var _observer;var _dmpparams;var _targets={};var _dmptype="scroll";var _groups=["pos_in_page","pos_in_article"];var _init=function(dmpparams){if(!_observer&&window.IntersectionObserver){_observer=new IntersectionObserver(_ioCallback,{})}_dmpparams=dmpparams;return true};var _sendDMPEvent=function(pos,mode,prnd){var obj={events:[{type:_dmptype,rnd:cX.library._randomString(),siteId:cX.library.m_siteId,prnd:prnd,userIds:[{id:cX.getUserId(),type:"cx"}],origin:_dmpparams.origin,segmentIds:undefined,customParameters:[{group:mode==0?_groups[0]:_groups[1],item:String(pos)+"%",type:"string"}]}]};cX.jsonpRequest("https://comcluster.cxense.com/dmp/push?callback={"+"{callback}"+"}&persisted="+encodeURIComponent(_dmpparams.persistedQueryId)+"&json="+encodeURIComponent(cX.JSON.stringify(obj)))};var _ioCallback=function(entries){entries.forEach(function(entry){if(entry.isIntersecting&&entry.target){var target=_targets[entry.target.id];if(target){_getSelectors(target.selector,target.rate).forEach(function(id){_sendDMPEvent(_targets[id].rate,_targets[id].mode,_targets[id].prnd);_observer.unobserve(_targets[id].element);_targets[id].element.parentNode.removeChild(_targets[id].element);delete _targets[id]})}}})};var _getSelectors=function(selector,rate){if(!rate){rate=100}var ids=[];Object.keys(_targets).forEach(function(k){if(_targets[k].selector===selector&&_targets[k].rate<=rate){ids.push(k)}});return ids};var _buildScrollRate=function(step){var scrollRate=[];var numSteps=Math.floor(100/step);for(var ii=1;ii<=numSteps;ii++){scrollRate.push(Math.floor(ii/numSteps*100))}return scrollRate};var _startTracking=function(mode,selector,frequency){if(_getSelectors(selector).length>0||!_observer){return}if(!frequency||isNaN(frequency)||(frequency<10||frequency>100)){frequency=25}var startY=0;var height=0;var el=document.querySelector(selector);switch(mode){case 0:selector="Page";height=document.documentElement.scrollHeight;break;case 1:if(el){startY=Math.floor(el.getBoundingClientRect().top+window.pageYOffset);height=Math.floor(el.getBoundingClientRect().height)}break;case 2:if(el){height=Math.floor(el.getBoundingClientRect().top+window.pageYOffset)}break}if(height!==0){var prnd=cX.library.m_rnd;_buildScrollRate(frequency).forEach(function(rate){var pos=Math.floor(height/100*rate)+startY;var id="cxscr_"+Math.random().toString(32).substring(2);document.body.insertAdjacentHTML("beforeend",'<div id="'+id+'" style="position:absolute;opacity:0;height:1px;top:'+pos+'px;"/>');_targets[id]={selector:selector,rate:rate,element:document.querySelector("#"+id),mode:mode,prnd:prnd};_observer.observe(_targets[id].element)});_sendDMPEvent(0,mode,prnd)}};return{init:function(dmpparams,mode,selector,frequency){if(typeof dmpparams!=="object"){return}if(!_instance){_instance=_init(dmpparams)}if(mode===0||selector){(function(f){"loading"===document.readyState?window.addEventListener("load",f,false):f()})(function(){_startTracking(mode,selector,frequency)})}return _instance},getTargets:function(){return _targets},setType:function(type){if(typeof type==="string"){_dmptype=type}},setGroups:function(groups){if(groups instanceof Array&&groups.length===2){_groups=groups}}}}();window.cxIoScrollDepth=cxIoScrollDepth;function _isRobot(){var robot_strings=["preview","phantomjs","spider","crawl","cxense","slurp","read ahead agent"];var re_bot=/\bbot|bot\b/;var ua=navigator.userAgent.toLowerCase();if(re_bot.test(ua)){return true}else{for(var i=0;i<robot_strings.length;i++){if(ua.indexOf(robot_strings[i])!=-1){return true}}}return ua.indexOf("mozilla")==0&&ua.indexOf(" ")==-1}var _cXcustom=function(){(window.cXcustom.q=window.cXcustom.q||[]).push(arguments);_queueExecute()};_cXcustom.q=window.cXcustom&&window.cXcustom.q?window.cXcustom.q:[];window.cXcustom=_cXcustom;_queueExecute();function _queueExecute(){while(window.cXcustom.q&&window.cXcustom.q.length>0){var command=window.cXcustom.q.shift();try{if(command[0]==="scrollDepth3"){cxIoScrollDepth.init(command[1],command[2],command[3])}}catch(e){}}}})();cX.callQueue.push(["invoke",function(){if(cx_args.siteIds[location.hostname]){var now=new Date;var datestr=now.getFullYear()+("0"+(now.getMonth()+1)).slice(-2)+("0"+now.getDate()).slice(-2)+("0"+now.getHours()).slice(-2);var url="https://csm.cxpublic.com/"+cx_args.domainScriptPath+"/domain/"+location.hostname+".js?"+datestr;cX.loadScript(url,true,undefined,"cX_csd_domainScript")}else{cX.callQueue.push(["invoke",function(){cxSendPV()}])}}]);
//# sourceMappingURL=Nikkei.js.map